<apex:page showHeader="false" standardStylesheets="false" controller="SitesKnowledgeController"  title="{!SITE_NICKNAME + ' | Knowledgebase'}"> 

  <apex:composition template="{!SITE_TEMPLATE_PRIMARY}" >
   <apex:define name="title"> 
        <title>{!SITE_NICKNAME} | Knowledgebase</title>
    </apex:define>
    <apex:define name="javascriptcalls">
     <script type="text/javascript">
        jQuery(document).ready(function() {
          jQuery('.toolbar-knowledgebase').addClass('active');
          redrawTable();    
          
          jQuery('.accordion').accordion({ active:{!if($CurrentPage.parameters.tab=='1',1,0)}, collapsible: false, autoHeight: false, icons: { 'header': 'sprite_cpicons closed', 'headerSelected': 'sprite_cpicons open'} });          
          
          //Add the accordion to sublists
              var split_at = 'ul.filter li.L1';
              jQuery('.lvl1').attr('onclick','').unbind('click');
              jQuery(split_at).each(function() {
                   
                   jQuery(this).next().add(jQuery(this).nextUntil(split_at)).wrapAll("<ul />");
              });
              jQuery('.sub-accordian').accordion({ active:false, header: '.header', collapsible: true, autoHeight: false, icons: { 'header': 'sprite_cpicons closed', 'headerSelected': 'sprite_cpicons open'} });          
        });
        function redrawTable(){
            oTable = jQuery('#datatable').dataTable( {aaSorting: [],"aoColumns": [null, null, {"sType": "date" }], "bFilter": false, "bLengthChange": false, sDom: 'lfr<"dt_fixed_height"t>ip' });  
        }
    </script>
    <script src="https://localhost/sidr-package-1.2.1/jquery.sidr.min.js"></script>
    <link rel="stylesheet" href="https://localhost/sidr-package-1.2.1/stylesheets/jquery.sidr.dark.css" />
    
    
    <style>
        ul li.L1{font-size:1.1em;font-weight:bold;}
        ul li.L2{margin-left:15px;}
        .sub-accordian .header{cursor:pointer;}
    </style>
   </apex:define>
    <apex:define name="body"> 
          <a id="simple-menu" href="#sidr">Toggle menu</a>

<div id="sidr" style="display:none;">
  <!-- Your content -->
  <ul>
    <li class="active"><a href="#">List 1</a></li>
    <li ><a href="#">List 2</a></li>
    <li><a href="#">List 3</a></li>
  </ul>
</div>
 
<script>
jQuery(document).ready(function() {
  jQuery('#simple-menu').sidr();
});
</script>
          
          
           <div class="banner grid full-width breadcrumb">
             <div class="c5 m"> </div>
             <div class="c11">
                <nav>
                    <a class="home" href="{!$Page.home}">Home</a>
                    <a class="current" href="#">Knowledgebase</a>
                </nav>
            </div>
         </div>  
             <div class="cp_core">
                  <apex:form id="kbtypes">
                    
                    <div class="column leftcol" id="resettable"> 
                        <div class="callout filter"> 
                            <div class="title-bar" > 
                                <span class="sprite_cpicons filter">&nbsp;</span>Search Filter
                                <apex:outputlink styleclass="remove" title="Remove all filters" value="{!$Page.knowledge}">
                                        Remove all filters
                                        <apex:param name="s" value="{!KEYWORDS}"/>
                                </apex:outputlink>
                            </div> 
                            <div class="callout-content current-filters"> 
                                <div class="container results"> 
                                    <h3>Current Filters:</h3> 
                                    <apex:outputPanel id="kb-filter">
                                            <dl class="current-filters"> 
                                                <dd class="filter-1">
                                                    <dl>     
                                                       <apex:outputPanel rendered="{!RELEASE!=''}">
                                                           <dd class="filter-1">
                                                               <dl>
                                                                   <dd>Release: {!if(RELEASE_TITLE!='',RELEASE_TITLE,RELEASE)}
                                                                       <a class="sprite_cpicons remove" title="Remove filter" onclick="unfilterkb('release')">&nbsp;</a>
                                                                   </dd>
                                                                </dl>
                                                            </dd>
                                                       </apex:outputPanel>
                                                      
                                                       <apex:outputPanel rendered="{!PRODUCT!=''}">
                                                           <dd class="filter-1">
                                                               <dl>
                                                                   <dd>Product: {!if(PRODUCT_TITLE!='',PRODUCT_TITLE,PRODUCT)}
                                                                       <a class="sprite_cpicons remove" title="Remove filter" onclick="unfilterkb('product')">&nbsp;</a>
                                                                   </dd>
                                                               </dl>
                                                            </dd>
                                                      </apex:outputPanel>     
                                                    </dl> 
                                                </dd> 
                                            </dl> 
                                    </apex:outputPanel>
                                </div> 
                            </div><!-- /Current Filters --> 
                          
                           
                            <div class="callout-content add-filters"> 
                                <ul class="accordion"> 
                                    
                                     <li> 
                                        <a class="results-link" href="#" title="Open Filter">Product:</a> 
                                        <div class="sub-accordian">
                                            <ul class="filter"> 
                                                
                                                <apex:repeat rendered="true" value="{!ProductCategories}" var="dc1">
                                                   <li class="header L1">
                                                         <apex:outputlink title="Click '{!dc1}' to Filter." value="#" >{!dc1}</apex:outputlink>
                                                   </li>           
                                                   <apex:repeat value="{!ProductCategories[dc1]}" var="dc2">
                                                       <li class="L2">
                                                       
                                                         
                                                         <apex:commandlink status="thinking" reRender="error, Sites_Knowledge_Widget" styleclass="lvl1" oncomplete="redrawTable()" >
                                                             Refresh
                                                         </apex:commandlink>
                                                         <apex:commandbutton status="thinking" reRender="error, Sites_Knowledge_Widget" action="{!runFilter}" styleclass="lvl1" >
                                                             {!Substitute(dc2.label,'__','')}
                                                             <apex:param name="filter" value="{!dc2.name}" />
                                                             <apex:param name="filtertype" value="release" />
                                                             <apex:param name="filtertitle" value="{!dc2.label}" />
                                                             <apex:actionStatus id="thinking" startText="Spinner" />
                                                         </apex:commandbutton>
                                                         <br />
                                                     </li>           
                                                   </apex:repeat> 
                                                   
                                                </apex:repeat>
                                            </ul> 
                                        </div>  
                                    </li>
                                    <li> 
                                        <a class="results-link" href="#" title="Open Filter">Release:</a> 
                                        <div class="sub-accordian">
                                            <ul class="filter"> 
                                                
                                                <apex:repeat rendered="true" value="{!ReleaseCategories}" var="dc1">
                                                   <li class="header L1">
                                                         <apex:outputlink styleclass="" title="Click '{!dc1}' to Filter." value="#" >{!dc1}</apex:outputlink>
                                                   </li>           
                                                   <apex:repeat value="{!ReleaseCategories[dc1]}" var="dc2">
                                                       <li class="L2">
                                                         <apex:outputlink styleclass="lvl1" title="Click '{!dc2.label}' to Filter."  onclick="filterkb('{!dc2.name}','release','{!dc2.label}')">{!Substitute(dc2.label,'__','')}</apex:outputlink>
                                                       </li>           
                                                   </apex:repeat> 
                                                   
                                                </apex:repeat>
                                            </ul> 
                                        </div>  
                                    </li>
                                    
                                </ul> 
                            </div><!-- /Filters Available --> 
                        </div><!-- /Search Filter --> 
                        
                    </div><!-- /Left Column --> 
                    
                    <div class="two-thirds right-23"> 
                        <div class="column-23"> 
                            <div class="callout kbsearch"> 
                                <span class="title-bar"><span class="sprite_cpicons knowledge">&nbsp;</span>Knowledgebase Search</span> 
                                <div class="callout-content kb-content"> 
                                    <div class="search-box"> 
                                        <apex:inputtext id="kbsearch" styleclass="kbsearch" value="{!KEYWORDS}" onfocus="if (this.value == 'Start searching here.') { this.value=''; }" onblur="if (this.value == '') { this.value='Start searching here.'; }" />
                                        <apex:commandButton action="{!dosearch}" styleclass="kbsubmit" value=" "/>
                                    </div> 
                                    <ul class="secondary-filter">
                                    </ul> 
                                </div> 
                                <apex:pageMessages id="error" />
                                <c:Sites_Knowledge_Widget id="Sites_Knowledge_Widget"
                                     KB_ARTICLETYPES="{!KB_ARTICLETYPES}"
                                     KB_CATEGORIES="{!KB_CATEGORIES}"
                                     KB_CURRENT_PAGE_NUMBER="{!KB_CURRENT_PAGE_NUMBER}"
                                     KB_KEYWORD="{!KB_KEYWORD}"
                                     KB_PAGE_SIZE="100"
                                     KB_SORTBY="{!KB_SORTBY}"
                                     KB_WINDOW="_self"
                                />
                               
                            </div><!-- /KB Search --> 
                        </div><!-- /Column-23 --> 
                        
                    </div><!-- /Two-Thirds Right-23--> 
           </apex:form>
        </div>
                 
    </apex:define>
  </apex:composition>  
        
</apex:page>